{% extends "base.html" %}

{% block title %}{{ agent.name }} - USS Enterprise NCC-1701-D{% endblock %}

{% block extra_head %}
<style>
    .agent-detail {
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
        min-height: 100vh;
    }
    
    .crew-hologram-large {
        position: relative;
        overflow: hidden;
        border-radius: 25px;
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(15px);
        border: 2px solid;
        padding: 2rem;
    }
    
    .crew-hologram-large.picard { border-color: #ff9c00; }
    .crew-hologram-large.troi { border-color: #cc99cc; }
    .crew-hologram-large.spock { border-color: #ffff99; }
    .crew-hologram-large.data { border-color: #9999cc; }
    .crew-hologram-large.scott { border-color: #cc6666; }
    
    .crew-hologram-large::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.1) 50%, transparent 70%);
        animation: hologram-scan 4s infinite;
    }
    
    @keyframes hologram-scan {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
    }
    
    .crew-avatar-large {
        width: 200px;
        height: 200px;
        border-radius: 50%;
        border: 4px solid;
        position: relative;
        overflow: hidden;
        margin: 0 auto;
    }
    
    .crew-avatar-large.picard { border-color: #ff9c00; }
    .crew-avatar-large.troi { border-color: #cc99cc; }
    .crew-avatar-large.spock { border-color: #ffff99; }
    .crew-avatar-large.data { border-color: #9999cc; }
    .crew-avatar-large.scott { border-color: #cc6666; }
    
    .crew-avatar-large::after {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: conic-gradient(from 0deg, transparent, rgba(255, 255, 255, 0.3), transparent);
        animation: rotate 6s linear infinite;
    }
    
    @keyframes rotate {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    
    .lcars-console-detail {
        background: linear-gradient(135deg, #2a2a4e 0%, #1a1a3e 100%);
        border-radius: 20px;
        border: 3px solid #ff9c00;
        box-shadow: 0 12px 40px rgba(255, 156, 0, 0.4);
    }
    
    .lcars-button-detail {
        background: linear-gradient(135deg, #ff9c00 0%, #ff6600 100%);
        border: none;
        border-radius: 12px;
        color: white;
        padding: 12px 24px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: bold;
        font-size: 1.1rem;
    }
    
    .lcars-button-detail:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 30px rgba(255, 156, 0, 0.6);
    }
    
    .crew-stats-detail {
        background: rgba(255, 255, 255, 0.08);
        border-radius: 15px;
        padding: 20px;
        border: 1px solid rgba(255, 255, 255, 0.15);
    }
    
    .mission-log {
        background: linear-gradient(135deg, #0a0a1a 0%, #1a1a3e 100%);
        border-radius: 20px;
        border: 2px solid #9999cc;
        position: relative;
        overflow: hidden;
    }
    
    .mission-log::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="1" fill="white" opacity="0.3"/><circle cx="80" cy="40" r="1" fill="white" opacity="0.2"/><circle cx="40" cy="80" r="1" fill="white" opacity="0.4"/><circle cx="90" cy="90" r="1" fill="white" opacity="0.1"/></svg>');
        animation: starfield 25s linear infinite;
    }
    
    @keyframes starfield {
        0% { transform: translateY(0); }
        100% { transform: translateY(-100px); }
    }
    
    .status-indicator-large {
        width: 16px;
        height: 16px;
        border-radius: 50%;
        display: inline-block;
        margin-right: 12px;
        animation: pulse 2s infinite;
    }
    
    .status-active { 
        background: #10b981; 
        box-shadow: 0 0 15px #10b981;
    }
</style>
{% endblock %}

{% block content %}
<div class="agent-detail">
    <!-- Agent Detail Header -->
    <div class="lcars-panel p-6 mb-8">
        <div class="flex justify-between items-center">
            <div class="flex items-center space-x-4">
                <a href="{{ url_for('observation_lounge') }}" class="lcars-button-detail">
                    <i class="fas fa-arrow-left mr-2"></i>Back to Observation Lounge
                </a>
                <div>
                    <h1 class="lcars-text text-3xl font-bold">{{ agent.name }}</h1>
                    <p class="lcars-text text-lg opacity-90">{{ agent.role }}</p>
                </div>
            </div>
            <div class="text-right">
                <div class="lcars-text text-sm opacity-75">Rank: {{ agent.name.split()[0] if 'Captain' in agent.name else 'Crew Member' }}</div>
                <div class="lcars-text text-sm opacity-75">Status: Active Duty</div>
            </div>
        </div>
    </div>

    <!-- Crew Member Holographic Display -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
        <!-- Crew Avatar and Stats -->
        <div class="lg:col-span-1">
            <div class="crew-hologram-large {{ agent_name }} text-center">
                <div class="crew-avatar-large {{ agent_name }} mb-6">
                    <lottie-player 
                        src="https://assets2.lottiefiles.com/packages/lf20_xyadoh9h.json"
                        background="transparent"
                        speed="1"
                        style="width: 100%; height: 100%;"
                        loop
                        autoplay>
                    </lottie-player>
                </div>
                <h2 class="lcars-text text-2xl font-bold mb-4">{{ agent.name }}</h2>
                <p class="lcars-text text-lg opacity-90 mb-6">{{ agent.description }}</p>
                
                <div class="crew-stats-detail">
                    <h3 class="lcars-text text-xl font-bold mb-4">Current Statistics</h3>
                    {% for stat_name, stat_value in agent.stats.items() %}
                    <div class="flex justify-between items-center mb-3">
                        <span class="lcars-text opacity-75">{{ stat_name.replace('_', ' ').title() }}:</span>
                        <span class="lcars-text font-semibold">{{ stat_value }}{% if stat_name == 'code_quality' %}%{% endif %}</span>
                    </div>
                    {% endfor %}
                    <div class="flex justify-between items-center mt-4">
                        <span class="lcars-text opacity-75">Status:</span>
                        <span class="status-indicator-large status-active"></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mission Log and Activities -->
        <div class="lg:col-span-2">
            <div class="mission-log p-6">
                <h3 class="lcars-text text-2xl font-bold mb-6">Mission Log</h3>
                <div class="space-y-4">
                    <div class="bg-white bg-opacity-10 rounded-lg p-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <h4 class="lcars-text font-semibold">{{ agent.name }} - Recent Activity</h4>
                                <p class="lcars-text text-sm opacity-75">Completed analysis of current project requirements and provided strategic recommendations.</p>
                            </div>
                            <span class="lcars-text text-xs opacity-60">5 minutes ago</span>
                        </div>
                    </div>

                    <div class="bg-white bg-opacity-10 rounded-lg p-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <h4 class="lcars-text font-semibold">{{ agent.name }} - System Review</h4>
                                <p class="lcars-text text-sm opacity-75">Conducted comprehensive review of development workflow and identified optimization opportunities.</p>
                            </div>
                            <span class="lcars-text text-xs opacity-60">15 minutes ago</span>
                        </div>
                    </div>

                    <div class="bg-white bg-opacity-10 rounded-lg p-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <h4 class="lcars-text font-semibold">{{ agent.name }} - Team Coordination</h4>
                                <p class="lcars-text text-sm opacity-75">Coordinated with other crew members to ensure optimal project execution and resource allocation.</p>
                            </div>
                            <span class="lcars-text text-xs opacity-60">30 minutes ago</span>
                        </div>
                    </div>

                    <div class="bg-white bg-opacity-10 rounded-lg p-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <h4 class="lcars-text font-semibold">{{ agent.name }} - Strategic Planning</h4>
                                <p class="lcars-text text-sm opacity-75">Developed strategic roadmap for upcoming development phases and milestone planning.</p>
                            </div>
                            <span class="lcars-text text-xs opacity-60">1 hour ago</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Systems Console and Actions -->
    <div class="lcars-console-detail p-6 mb-8">
        <h3 class="lcars-text text-2xl font-bold mb-6">{{ agent.name }}'s Console</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <h4 class="lcars-text text-lg font-semibold mb-4">Current Operations</h4>
                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <span class="lcars-text">Processing Status:</span>
                        <span class="lcars-text font-semibold text-green-400">Active</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="lcars-text">Response Time:</span>
                        <span class="lcars-text font-semibold text-blue-400">2.3s</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="lcars-text">Success Rate:</span>
                        <span class="lcars-text font-semibold text-green-400">99.8%</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="lcars-text">Memory Usage:</span>
                        <span class="lcars-text font-semibold text-yellow-400">Optimal</span>
                    </div>
                </div>
            </div>
            
            <div>
                <h4 class="lcars-text text-lg font-semibold mb-4">Available Actions</h4>
                <div class="space-y-3">
                    <button class="lcars-button-detail w-full" onclick="getAgentInsights()">
                        <i class="fas fa-lightbulb mr-2"></i>Get {{ agent.name.split()[0] }}'s Insights
                    </button>
                    <button class="lcars-button-detail w-full" onclick="analyzeProject()">
                        <i class="fas fa-search mr-2"></i>Analyze Current Project
                    </button>
                    <button class="lcars-button-detail w-full" onclick="generateReport()">
                        <i class="fas fa-file-alt mr-2"></i>Generate Report
                    </button>
                    <button class="lcars-button-detail w-full" onclick="window.location.href='{{ url_for('observation_lounge') }}'">
                        <i class="fas fa-users mr-2"></i>Return to Crew
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Insights and Analysis -->
    <div class="lcars-accent p-6">
        <h3 class="lcars-text text-2xl font-bold mb-6">{{ agent.name }}'s Recent Insights</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="bg-white bg-opacity-10 rounded-lg p-4">
                <h4 class="lcars-text font-semibold mb-3">Strategic Analysis</h4>
                <p class="lcars-text text-sm opacity-75">
                    Based on current project metrics and team performance, {{ agent.name.split()[0] }} recommends focusing on 
                    user experience optimization and implementing automated testing procedures to improve overall project quality.
                </p>
            </div>
            
            <div class="bg-white bg-opacity-10 rounded-lg p-4">
                <h4 class="lcars-text font-semibold mb-3">Risk Assessment</h4>
                <p class="lcars-text text-sm opacity-75">
                    {{ agent.name.split()[0] }} has identified potential bottlenecks in the deployment pipeline and suggests 
                    implementing additional monitoring and alerting systems to prevent future issues.
                </p>
            </div>
            
            <div class="bg-white bg-opacity-10 rounded-lg p-4">
                <h4 class="lcars-text font-semibold mb-3">Team Recommendations</h4>
                <p class="lcars-text text-sm opacity-75">
                    {{ agent.name.split()[0] }} recommends scheduling regular team retrospectives and implementing 
                    pair programming sessions to improve knowledge sharing and code quality.
                </p>
            </div>
            
            <div class="bg-white bg-opacity-10 rounded-lg p-4">
                <h4 class="lcars-text font-semibold mb-3">Technical Guidance</h4>
                <p class="lcars-text text-sm opacity-75">
                    {{ agent.name.split()[0] }} suggests upgrading the development environment and implementing 
                    automated code formatting to maintain consistency across the project.
                </p>
            </div>
        </div>
    </div>
</div>

<!-- Loading Spinner -->
<div id="loadingSpinner" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
    <div class="relative top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2">
        <lottie-player 
            src="https://assets5.lottiefiles.com/packages/lf20_xyadoh9h.json"
            background="transparent"
            speed="1"
            style="width: 200px; height: 200px;"
            loop
            autoplay>
        </lottie-player>
        <p class="lcars-text text-center mt-4">Processing...</p>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    function showLoadingSpinner() {
        document.getElementById('loadingSpinner').classList.remove('hidden');
    }

    function hideLoadingSpinner() {
        document.getElementById('loadingSpinner').classList.add('hidden');
    }

    function getAgentInsights() {
        showLoadingSpinner();
        
        const context = `Agent: {{ agent.name }}. Role: {{ agent.role }}. 
                        Current mission: Project management and development. 
                        Requesting specific insights and recommendations.`;
        
        fetch('/api/agents/insights', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ context: context })
        })
        .then(response => response.json())
        .then(data => {
            hideLoadingSpinner();
            if (data.success) {
                alert('{{ agent.name.split()[0] }}\'s insights generated successfully! Check the insights section for details.');
            } else {
                alert('Error getting agent insights');
            }
        })
        .catch(error => {
            hideLoadingSpinner();
            console.error('Error:', error);
            alert('Error getting agent insights');
        });
    }

    function analyzeProject() {
        showLoadingSpinner();
        
        setTimeout(() => {
            hideLoadingSpinner();
            alert('{{ agent.name.split()[0] }} has completed project analysis. Check the mission log for details.');
        }, 2000);
    }

    function generateReport() {
        showLoadingSpinner();
        
        setTimeout(() => {
            hideLoadingSpinner();
            alert('{{ agent.name.split()[0] }} has generated a comprehensive report. Check the insights section for details.');
        }, 3000);
    }
</script>
{% endblock %} 