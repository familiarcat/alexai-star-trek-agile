<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LCARS - Mission Log</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/assets/lcars.css">
</head>
<body>
    <div class="lcars-container">
        <!-- LCARS Sidebar Menu -->
        <div class="lcars-sidebar">
            <div class="lcars-menu-header">
                LCARS MENU
            </div>
            
            <div class="lcars-menu-item" onclick="location.href='/'">
                <i class="fas fa-tachometer-alt lcars-mr-10"></i>
                DASHBOARD
            </div>
            
            <div class="lcars-menu-item active" onclick="location.href='/projects'">
                <i class="fas fa-project-diagram lcars-mr-10"></i>
                PROJECTS
            </div>
            
            <div class="lcars-menu-item" onclick="location.href='/observation-lounge'">
                <i class="fas fa-eye lcars-mr-10"></i>
                OBSERVATION LOUNGE
            </div>
            
            <div class="lcars-menu-item" onclick="location.href='/project-detail'">
                <i class="fas fa-tasks lcars-mr-10"></i>
                TASK MANAGER
            </div>
            
            <div class="lcars-menu-item" onclick="location.href='/alexai'">
                <i class="fas fa-robot lcars-mr-10"></i>
                ALEXAI CORE
            </div>
            
            <!-- LCARS Status Summary -->
            <div class="lcars-panel lcars-mt-10">
                <div class="lcars-text lcars-text-large lcars-text-gold lcars-mb-10">SYSTEM STATUS</div>
                
                <div class="lcars-status">
                    <div class="lcars-status-indicator"></div>
                    <span>MISSION DATABASE: ONLINE</span>
                </div>
                
                <div class="lcars-status">
                    <div class="lcars-status-indicator"></div>
                    <span>PROJECT TRACKING: ACTIVE</span>
                </div>
                
                <div class="lcars-status">
                    <div class="lcars-status-indicator"></div>
                    <span>TEAM COORDINATION: OPTIMAL</span>
                </div>
                
                <div class="lcars-status">
                    <div class="lcars-status-indicator"></div>
                    <span>AI INSIGHTS: AVAILABLE</span>
                </div>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="lcars-main">
            <!-- Top Header Bar -->
            <div class="lcars-nav">
                <div class="lcars-nav-brand">
                    LCARS SYSTEM 3 - MISSION LOG
                </div>
                <div class="lcars-nav-menu">
                    <div class="lcars-button secondary" onclick="createMockData()">
                        <i class="fas fa-database lcars-mr-10"></i>
                        INITIALIZE DATA
                    </div>
                    <div class="lcars-button secondary" onclick="refreshProjects()">
                        <i class="fas fa-sync-alt lcars-mr-10"></i>
                        REFRESH
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="lcars-fade-in">
                <!-- Mission Statistics -->
                <div class="lcars-data-grid">
                    <div class="lcars-data-item">
                        <div class="lcars-data-value" id="total-projects">-</div>
                        <div class="lcars-data-label">TOTAL MISSIONS</div>
                    </div>
                    
                    <div class="lcars-data-item">
                        <div class="lcars-data-value" id="active-projects">-</div>
                        <div class="lcars-data-label">ACTIVE MISSIONS</div>
                    </div>
                    
                    <div class="lcars-data-item">
                        <div class="lcars-data-value" id="completed-projects">-</div>
                        <div class="lcars-data-label">COMPLETED</div>
                    </div>
                    
                    <div class="lcars-data-item">
                        <div class="lcars-data-value" id="total-tasks">-</div>
                        <div class="lcars-data-label">TOTAL TASKS</div>
                    </div>
                </div>

                <!-- Projects List -->
                <div class="lcars-panel">
                    <div class="lcars-text lcars-text-xlarge lcars-text-gold lcars-mb-15">
                        <i class="fas fa-rocket lcars-mr-10"></i>
                        ACTIVE MISSIONS
                    </div>
                    
                    <div id="projects-list" class="lcars-text">
                        <div class="lcars-text-center lcars-text-grey">
                            <i class="fas fa-spinner fa-spin lcars-mr-10"></i>
                            Loading missions...
                        </div>
                    </div>
                </div>

                <!-- Project Details Modal -->
                <div id="project-modal" class="lcars-panel" style="display: none;">
                    <div class="lcars-text lcars-text-xlarge lcars-text-gold lcars-mb-15">
                        <i class="fas fa-info-circle lcars-mr-10"></i>
                        MISSION DETAILS
                    </div>
                    
                    <div id="project-details" class="lcars-text">
                        <!-- Project details will be loaded here -->
                    </div>
                    
                    <div class="lcars-data-grid lcars-mt-15">
                        <div class="lcars-button" onclick="closeProjectModal()">
                            <i class="fas fa-times lcars-mr-10"></i>
                            CLOSE
                        </div>
                        <div class="lcars-button secondary" onclick="openKanbanBoard()">
                            <i class="fas fa-columns lcars-mr-10"></i>
                            KANBAN BOARD
                        </div>
                        <div class="lcars-button secondary" onclick="getAIInsights()">
                            <i class="fas fa-robot lcars-mr-10"></i>
                            AI INSIGHTS
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Socket.IO
        const socket = io();
        let currentProjects = [];
        let selectedProjectId = null;

        // Load projects data
        async function loadProjectsData() {
            try {
                // Load dashboard stats
                const statsResponse = await fetch('/api/dashboard/stats');
                const statsData = await statsResponse.json();
                
                if (statsData.success) {
                    document.getElementById('total-projects').textContent = statsData.stats.total_projects;
                    document.getElementById('total-tasks').textContent = statsData.stats.total_tasks;
                    
                    // Calculate active and completed projects
                    const projectsResponse = await fetch('/api/projects');
                    const projectsData = await projectsResponse.json();
                    
                    if (projectsData.success) {
                        currentProjects = projectsData.projects;
                        const activeProjects = projectsData.projects.filter(p => p.status === 'in_progress').length;
                        const completedProjects = projectsData.projects.filter(p => p.status === 'completed').length;
                        
                        document.getElementById('active-projects').textContent = activeProjects;
                        document.getElementById('completed-projects').textContent = completedProjects;
                        
                        // Render projects list
                        renderProjectsList(projectsData.projects);
                    }
                }
            } catch (error) {
                console.error('Error loading projects data:', error);
                document.getElementById('projects-list').innerHTML = 
                    '<div class="lcars-text-center lcars-text-red">Error loading missions</div>';
            }
        }

        function renderProjectsList(projects) {
            const projectsContainer = document.getElementById('projects-list');
            
            if (projects.length === 0) {
                projectsContainer.innerHTML = `
                    <div class="lcars-text-center lcars-text-grey">
                        <i class="fas fa-inbox lcars-mr-10"></i>
                        No missions available. Initialize data to begin.
                    </div>
                `;
                return;
            }

            projectsContainer.innerHTML = projects.map(project => `
                <div class="lcars-panel lcars-mb-10" onclick="selectProject('${project.id}')">
                    <div class="lcars-text lcars-text-large lcars-text-gold lcars-mb-10">
                        <i class="fas fa-project-diagram lcars-mr-10"></i>
                        ${project.name}
                    </div>
                    
                    <div class="lcars-text lcars-mb-10">
                        ${project.description || 'No description available'}
                    </div>
                    
                    <div class="lcars-data-grid">
                        <div class="lcars-l-shape">
                            <i class="fas fa-tag lcars-mr-10"></i>
                            TYPE: ${project.project_type.toUpperCase()}
                        </div>
                        
                        <div class="lcars-l-shape">
                            <i class="fas fa-signal lcars-mr-10"></i>
                            STATUS: ${project.status.replace('_', ' ').toUpperCase()}
                        </div>
                        
                        <div class="lcars-l-shape">
                            <i class="fas fa-users lcars-mr-10"></i>
                            TEAM: ${project.team_members ? project.team_members.length : 0} MEMBERS
                        </div>
                        
                        <div class="lcars-l-shape">
                            <i class="fas fa-code lcars-mr-10"></i>
                            TECH: ${project.tech_stack ? project.tech_stack.length : 0} STACKS
                        </div>
                    </div>
                    
                    <div class="lcars-data-grid lcars-mt-10">
                        <div class="lcars-button secondary" onclick="event.stopPropagation(); openProjectDetails('${project.id}')">
                            <i class="fas fa-eye lcars-mr-10"></i>
                            DETAILS
                        </div>
                        
                        <div class="lcars-button secondary" onclick="event.stopPropagation(); getProjectInsights('${project.id}')">
                            <i class="fas fa-robot lcars-mr-10"></i>
                            AI INSIGHTS
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function selectProject(projectId) {
            selectedProjectId = projectId;
            // Highlight selected project
            document.querySelectorAll('.lcars-panel').forEach(panel => {
                panel.style.borderColor = 'var(--lcars-gold)';
            });
            event.currentTarget.style.borderColor = 'var(--lcars-orange)';
        }

        async function openProjectDetails(projectId) {
            try {
                const response = await fetch(`/api/projects/${projectId}`);
                const data = await response.json();
                
                if (data.success) {
                    const project = data.project;
                    const detailsContainer = document.getElementById('project-details');
                    
                    detailsContainer.innerHTML = `
                        <div class="lcars-text lcars-text-xlarge lcars-text-gold lcars-mb-15">
                            ${project.name}
                        </div>
                        
                        <div class="lcars-text lcars-mb-15">
                            ${project.description || 'No description available'}
                        </div>
                        
                        <div class="lcars-data-grid">
                            <div class="lcars-l-shape">
                                <i class="fas fa-tag lcars-mr-10"></i>
                                PROJECT TYPE: ${project.project_type.toUpperCase()}
                            </div>
                            
                            <div class="lcars-l-shape">
                                <i class="fas fa-signal lcars-mr-10"></i>
                                STATUS: ${project.status.replace('_', ' ').toUpperCase()}
                            </div>
                            
                            <div class="lcars-l-shape">
                                <i class="fas fa-calendar lcars-mr-10"></i>
                                CREATED: ${new Date(project.created_at).toLocaleDateString()}
                            </div>
                            
                            <div class="lcars-l-shape">
                                <i class="fas fa-clock lcars-mr-10"></i>
                                UPDATED: ${new Date(project.updated_at).toLocaleDateString()}
                            </div>
                        </div>
                        
                        ${project.team_members && project.team_members.length > 0 ? `
                            <div class="lcars-text lcars-text-large lcars-text-gold lcars-mt-15 lcars-mb-10">
                                <i class="fas fa-users lcars-mr-10"></i>
                                MISSION TEAM
                            </div>
                            <div class="lcars-text lcars-mb-15">
                                ${project.team_members.join(', ')}
                            </div>
                        ` : ''}
                        
                        ${project.tech_stack && project.tech_stack.length > 0 ? `
                            <div class="lcars-text lcars-text-large lcars-text-gold lcars-mb-10">
                                <i class="fas fa-code lcars-mr-10"></i>
                                TECHNOLOGY STACK
                            </div>
                            <div class="lcars-text lcars-mb-15">
                                ${project.tech_stack.join(', ')}
                            </div>
                        ` : ''}
                    `;
                    
                    document.getElementById('project-modal').style.display = 'block';
                    selectedProjectId = projectId;
                }
            } catch (error) {
                console.error('Error loading project details:', error);
            }
        }

        function closeProjectModal() {
            document.getElementById('project-modal').style.display = 'none';
        }

        async function getProjectInsights(projectId) {
            try {
                const response = await fetch(`/api/projects/${projectId}/insights`);
                const data = await response.json();
                
                if (data.success) {
                    alert('AI Insights: ' + JSON.stringify(data.insights, null, 2));
                } else {
                    alert('Unable to get AI insights at this time');
                }
            } catch (error) {
                console.error('Error getting project insights:', error);
                alert('Error getting AI insights');
            }
        }

        function openKanbanBoard() {
            if (selectedProjectId) {
                window.location.href = `/project-detail?id=${selectedProjectId}`;
            } else {
                alert('Please select a project first');
            }
        }

        function getAIInsights() {
            if (selectedProjectId) {
                getProjectInsights(selectedProjectId);
            } else {
                alert('Please select a project first');
            }
        }

        async function createMockData() {
            try {
                const response = await fetch('/api/database/mock', { method: 'POST' });
                const result = await response.json();
                
                if (result.success) {
                    alert('Mock data created successfully!');
                    loadProjectsData();
                } else {
                    alert('Error creating mock data');
                }
            } catch (error) {
                console.error('Error creating mock data:', error);
                alert('Error creating mock data');
            }
        }

        function refreshProjects() {
            loadProjectsData();
        }

        // Socket.IO event handlers
        socket.on('connect', function() {
            console.log('Connected to LCARS System');
        });

        socket.on('project_updated', function(data) {
            console.log('Project updated:', data);
            loadProjectsData();
        });

        // Load data on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadProjectsData();
        });
    </script>
</body>
</html> 